import os
censor_name="""1234567890!@#$%^\"&*()_+\|/№;%:?  """
flag_1=True
flag_user=True
searching_users=[]
try:
    with open("users.txt") as file_obj:
        all_users=file_obj.readlines()
except FileNotFoundError:
    with open("users.txt","w") as file_obj:
        pass
    with open("users.txt") as file_obj:
        all_users=file_obj.readlines()
while True:
    choice=str(input("Что вы хотите от бота?:"))
    if choice.lower() == "добавить":
        while flag_user:
            flag_1=True
            name=str(input("Введите имя:"))
            name=name.strip()
            if name == "выход":
            if len(name)>1 and len(name) < 16:
                for letter in name:
                    if letter in censor_name:
                        print("Ошибка ввода имени")
                        flag_1=False
                        break
                if flag_1 ==  True:
                    name=name.title()
                    age=str(input("Введите ваш возраст:"))
                    if age == "выход":
                        break
                    elif age.isdigit():
                        if int(age) in range(0,121):
                            with open("users.txt","a") as file_obj:
                                file_obj.write("<name=%s:age=%s>\n"%(name,age))
                                flag_user=False
                        else:
                            print("Ошибка ввода возраста")
                    else:
                        print("Ошибка ввода возраста")
            else:
                print("ошибка ввода имени")
    elif choice.lower() == "просмотр":
        choice_users=str(input("всех\по имени?:"))
        if choice_users.lower() == "всех":
            with open("users.txt") as file_obj:
                all_users=file_obj.readlines()
            for i in range(len(all_users)):
                curr_row=all_users[i]
                print("Пользователь %s, возраст %s лет"%(curr_row[6:curr_row.find(":")],curr_row[curr_row.find(":")+5:curr_row.find(">")]))
        elif choice_users.lower() == "по имени":
            searching_users.clear()
            searching_name=str(input("По какому имени ищем?:")).title()
            for row in (all_users):
                if row.find(searching_name) > 1:
                    searching_users.append(row)
            if len(searching_users) == 0:
                print("Пользователей с таким именем не найдено")
            else:
                for i in range(len(searching_users)):
                    curr_row=searching_users[i]
                    print("Пользователь %s, возраст %s лет"%(curr_row[6:curr_row.find(":")],curr_row[curr_row.find(":")+5:curr_row.find(">")]))
    elif choice.lower() == "инструкция":
        print("""\nДля того чтобы добавить в базу пользователя - напишите 'добавить'
Для просмотра пользователей напишите 'просмотр'
Для выхода из команд бота напишите 'выход'
              """)
    elif choice.lower() == "выход":
        os.system("exit")
    else:
        print("Такой команды нет")

